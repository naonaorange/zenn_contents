---
title: "ROSã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šã®3Dãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹"
emoji: "ğŸ˜€"
type: "tech"
topics: ["20200418","ros"]
published: true
---
Rvizã‚’ä½¿ç”¨ã—ã¦å®Ÿæ©Ÿã®3Dã‚»ãƒ³ã‚µã®æƒ…å ±ã‚’å¯è¦–åŒ–ã™ã‚‹æ–¹æ³•ã¯è‰²ã‚“ãªæ‰€ã«ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šã«ã‚ã‚‹3Dã‚»ãƒ³ã‚µã®æƒ…å ±ã‚’å¯è¦–åŒ–ã™ã‚‹æ–¹æ³•ã‚’ã‚„ã£ã¦ã¿ã¾ã™ã€‚

ã“ã®æ–¹æ³•ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šã®ç†æƒ³çš„ãª3Dç©ºé–“ã§ã©ã®ã‚ˆã†ãª3Dãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã‚‹ã®ã‹ã‚ã‹ã‚‹ã®ã§ã€ãƒ­ãƒœãƒƒãƒˆã®Visualizationã®ãƒ‡ãƒãƒƒã‚°ãŒã—ã‚„ã™ã„ã¨æ€ã„ã¾ã™ã€‚

æœ€çµ‚çš„ã«ã¯ã€ä¸‹ã®å›³ã®ã‚ˆã†ã«ã«Gazeboã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç©ºé–“å†…ã«Kinectã‚’é…ç½®ã—ã€KinectãŒå‡ºåŠ›ã™ã‚‹3Dãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã‚½ãƒ•ãƒˆã®Rvizã§è¡¨ç¤ºã—ã¾ã™ã€‚
ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç©ºé–“å†…ã®ãƒ¢ãƒ‡ãƒ«é…ç½®ãŒå¤‰ã‚ã‚Œã°ã€Rvizå†…ã®3Dãƒ‡ãƒ¼ã‚¿ã‚‚å¤‰åŒ–ã—ã¾ã™ã€‚
![](/images/20200418_ros_sim/1.png)
![](/images/20200418_ros_sim/1-1.png)

# å‰æ
Ubuntu 16.04 64bit
ROS Kinetic Kame

# äº‹å‰æº–å‚™
å¿…è¦ãªã‚½ãƒ•ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```
sudo apt install ros-kinetic-gazebo-ros-pkgs ros-kinetic-gazebo-ros-control ros-kinetic-openni2-launch
```

ã¾ãŸã€ä¸‹è¨˜ãƒ¬ãƒã‚¸ãƒˆãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
https://bitbucket.org/osrf/gazebo_models/src/default/


# 3Dãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã™ã‚‹Kinectãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ

## ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ç§»å‹•
ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸkinect.zipã‚’å±•é–‹ã—ã€ãƒ•ã‚©ãƒ«ãƒ€ã‚’~/.gazebo/modelsãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã•ã›ã¾ã™ã€‚
~/.gazebo/modelså†…ã«3Dãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã“ã¨ã§ã€gazeboã‚’èµ·å‹•ã—ãŸã‚ã¨ã«æ‰‹å‹•ã§ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†
gazebo_modelsãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯å˜ãªã‚‹3Dãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚
ã“ã®ãƒ¢ãƒ‡ãƒ«ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šã«è¡¨ç¤ºã•ã›ãŸã‹ã‚‰ã¨è¨€ã£ã¦ã€3Dãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã™ã‚‹æ©Ÿèƒ½ã¯ã¤ã„ã¦ã„ã¾ã›ã‚“ã€‚
ãã“ã§ã€gazeboã®pluginæ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã€3Dãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã•ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã“ã§å¤‰æ›´ã™ã‚‹ã®ã¯kinectãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã‚ã‚‹4ã¤ã®sdfãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚
- model.sdf
- model-1_2.sdf
- model-1_3.sdf
- model-1_4.sdf

å¤‰æ›´ã®å†…å®¹ã¯cameraã‚¿ã‚°ã®çµ‚ã‚ã‚Šã¨sensorã‚¿ã‚°ã®çµ‚ã‚ã‚Šã®é–“ã«ä¸‹ã®å†…å®¹ã‚’æŒ¿å…¥ã—ã¦ãã ã•ã„ã€‚

```xml
        <plugin name="camera_plugin" filename="libgazebo_ros_openni_kinect.so">
          <baseline>0.2</baseline>
          <alwaysOn>true</alwaysOn>
          <!-- Keep this zero, update_rate in the parent <sensor> tag
            will control the frame rate. -->
          <updateRate>0.0</updateRate>
          <cameraName>camera_ir</cameraName>
          <imageTopicName>/camera/color/image_raw</imageTopicName>
          <cameraInfoTopicName>/camera/color/camera_info</cameraInfoTopicName>
          <depthImageTopicName>/camera/depth/image_raw</depthImageTopicName>
          <depthImageCameraInfoTopicName>/camera/depth/camera_info</depthImageCameraInfoTopicName>
          <pointCloudTopicName>/camera/depth/points</pointCloudTopicName>
          <frameName>camera_link</frameName>
          <pointCloudCutoff>0.5</pointCloudCutoff>
          <pointCloudCutoffMax>3.0</pointCloudCutoffMax>
          <distortionK1>0</distortionK1>
          <distortionK2>0</distortionK2>
          <distortionK3>0</distortionK3>
          <distortionT1>0</distortionT1>
          <distortionT2>0</distortionT2>
          <CxPrime>0</CxPrime>
          <Cx>0</Cx>
          <Cy>0</Cy>
          <focalLength>0</focalLength>
          <hackBaseline>0</hackBaseline>
        </plugin>
```

ã“ã‚Œã§æº–å‚™ã¯OKã§ã™ã€‚

# Gazeboã§Kinectãƒ¢ãƒ‡ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹
ç©ºã®gazeboãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãã¾ã™ã€‚
```
roslaunch gazebo_ros empty_world.launch
```
Insertã‚¿ãƒ–ã‚’é¸æŠã—ã€Kinectãƒ¢ãƒ‡ãƒ«ã‚’worldã«ãƒ‰ãƒ©ãƒƒã‚°ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã™ã€‚
![](/images/20200418_ros_sim/2.png)

æ¬¡ã«ã€3Dãƒ‡ãƒ¼ã‚¿ãŒåˆ†ã‹ã‚Šã‚„ã™ããªã‚‹ã‚ˆã†ã«ã€é©å½“ãªãƒ¢ãƒ‡ãƒ«ã‚’worldã«è¿½åŠ ã—ã¾ã™ã€‚
![](/images/20200418_ros_sim/3.png)

# Rvizã§3Dãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã™ã‚‹
Rvizã‚’èµ·å‹•ã—ã¾ã™ã€‚
```
rosrun rviz rviz
```
èµ¤æ å†…ã®è¨­å®šã‚’è¡Œã†ã¨ã€gazeboã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ãŸçŠ¶æ…‹ã®3Dãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚
![](/images/20200418_ros_sim/4.png)

ã“ã‚“ãªæ„Ÿã˜ã§ã€gazeboå†…ã®ãƒ¢ãƒ‡ãƒ«ä½ç½®ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€Rvizå†…ã®3Dãƒ‡ãƒ¼ã‚¿ã‚‚å¤‰åŒ–ã—ã¾ã™ã€‚
![](/images/20200418_ros_sim/5.png)
![](/images/20200418_ros_sim/6.png)

# 3Dãƒ‡ãƒ¼ã‚¿å‡ºåŠ›å†…å®¹ã«ã¤ã„ã¦
gazebo, rvizã‚’èµ·å‹•ã—ãŸçŠ¶æ…‹ã§ã¯ä¸‹ã®ã‚ˆã†ãªãƒˆãƒ”ãƒƒã‚¯ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚
```
rostopic list
/camera/color/camera_info
/camera/color/image_raw
/camera/color/image_raw/compressed
/camera/color/image_raw/compressed/parameter_descriptions
/camera/color/image_raw/compressed/parameter_updates
/camera/color/image_raw/compressedDepth
/camera/color/image_raw/compressedDepth/parameter_descriptions
/camera/color/image_raw/compressedDepth/parameter_updates
/camera/color/image_raw/theora
/camera/color/image_raw/theora/parameter_descriptions
/camera/color/image_raw/theora/parameter_updates
/camera/depth/camera_info
/camera/depth/image_raw
/camera/depth/points
/camera_ir/parameter_descriptions
/camera_ir/parameter_updates
/clicked_point
/clock
/gazebo/link_states
/gazebo/model_states
/gazebo/parameter_descriptions
/gazebo/parameter_updates
/gazebo/set_link_state
/gazebo/set_model_state
/gazebo_gui/parameter_descriptions
/gazebo_gui/parameter_updates
/initialpose
/move_base_simple/goal
/rosout
/rosout_agg
/tf
/tf_static
```
ã“ã“ã§ã€3Dãƒ‡ãƒ¼ã‚¿ã¯/camera/depth/pointsã«ãªã‚Šã¾ã™ã€‚
ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹gazeboãŒå‡ºåŠ›ã—ã€rivizãŒå—ä¿¡ã—ã¦å¯è¦–åŒ–ã—ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚
ã§ã™ã®ã§ã€ã“ã®å‡ºåŠ›ã‚’ä½¿ãˆã°ã€è‡ªåˆ†ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«3Dãƒ‡ãƒ¼ã‚¿ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚

```
rostopic info /camera/depth/points 
Type: sensor_msgs/PointCloud2

Publishers: 
 * /gazebo 

Subscribers: 
 * /rviz_1587205942154024664 
```

# æœ€å¾Œã«
Kinectã®ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚Œã°ã€3Dã‚»ãƒ³ã‚µã®ä»•æ§˜ã‚’å¤‰æ›´ã§ãã‚‹ãŸã‚ã€è‡ªåˆ†ã®å¥½ããªãƒ‡ãƒã‚¤ã‚¹ã«å¤‰æ›´ã§ãã¾ã™ã€‚
ã¾ãŸã€ä»Šå›ä½¿ã£ãŸå††æŸ±ã®ãƒ¢ãƒ‡ãƒ«ã‚‚CADã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ãˆãŸã‚Šã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§å‹•ã‹ã›ãŸã‚Šã‚‚ã§ãã¾ã™ã€‚
ä»Šå›ã¯æ‰‹è»½ã«ç¢ºèªã™ã‚‹ãŸã‚ã«ã§ãã‚‹ã ã‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã›ãšã«ä½¿ç”¨ã—ã¦ã¿ã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã¯åŸºæœ¬çš„ã«ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã®å†…å®¹ã‚’ã‚„ã£ã¦ã„ã¦ã€è¨˜è¼‰ãŒãªã‹ã£ãŸã¨ã“ã‚ã‚’è£œå®Œã—ãªãŒã‚‰è¨˜äº‹ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚
http://gazebosim.org/tutorials/?tut=ros_depth_camera






